<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
		<link href="./styles/main.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		<script src="src/js/three.js"></script>
		<script>
			//Scene Init
			var scene = new THREE.Scene();
			const loader=new THREE.CubeTextureLoader();
			const backtexture=loader.load([
			'./resources/posx.jpg',
			'./resources/negx.jpg',
			'./resources/posy.jpg',
			'./resources/negy.jpg',
			'./resources/posz.jpg',
			'./resources/negz.jpg',
			]);
			scene.background=new THREE.Color(0xaaffff);
			//scene.background=new THREE.Color(0x00f0ff);

			//Camera Init
			var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000 );
			camera.position.y=2;
			camera.position.z=6;

			//Rendering 
			const renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			

			//Function to load models
			function loadModel(url){
				var loader = new THREE.JSONLoader();
				loader.load(url,modelLoaded);
			}
			//Callback function for loader
			function modelLoaded(geometry, materials){
				var mat=new THREE.MeshFaceMaterial(materials);
				var object = new THREE.Mesh(geometry,mat);
				scene.add(object);
				render(); //only if no animation
			}

			//Light Init
			var light=new THREE.DirectionalLight();
			light.position.set(0,2,1);
			scene.add(light);
			//scene.add( new THREE.AmbientLight(0x110000))


			//Platform 
			tiers=33;
			sides=33;
			var platgeo = new THREE.BoxGeometry();
			var platmat = new THREE.MeshPhongMaterial( {polygonOffset:true,polygonOffsetUnits:1,polygonOffsetFactor:1,color: 0xffcc00} );
			var platform = new THREE.Mesh(platgeo, platmat);
			platform.position.z=-3;
			platform.position.y=-1;
			platform.scale.x=2;
			platform.scale.y=0.5;
			platform.scale.z=10;
			scene.add(platform);

			//gate
			var gategeo=new THREE.BoxGeometry();
			var gatemat=new THREE.MeshPhongMaterial( {polygonOffset:true,polygonOffsetUnits:1,polygonOffsetFactor:1,color: 0x00ff00} );
			var gate= new THREE.Mesh(gategeo,gatemat);
			gate.scale.x=1.8;
			gate.scale.z=0.5;
			gate.position.z=-4;
			gate.position.y=-0.5;
			scene.add(gate);

			//trigger
			var triggeo=new THREE.BoxGeometry();
			var triggmat=new THREE.MeshPhongMaterial( {polygonOffset:true,polygonOffsetUnits:1,polygonOffsetFactor:1,color: 0x0000ff} );
			var trigger= new THREE.Mesh(triggeo,triggmat);
			trigger.scale.y=0.1;
			trigger.position.y=-0.5;
			trigger.position.z=-2;
			scene.add(trigger);

			var geometry = new THREE.TorusGeometry();
			var material = new THREE.MeshPhongMaterial({polygonOffset:true,polygonOffsetUnits:1,polygonOffsetFactor:1,color: 0xff00ff});
			var cube = new THREE.Mesh( geometry, material );
			//scene.add( cube );

			var character=new THREE.DodecahedronGeometry(0.4);
			var characterfirst=new THREE.Mesh(character, material);
			characterfirst.position.z=2.2;
			scene.add(characterfirst);

			var geo= new THREE.BoxGeometry();
			var mat= new THREE.MeshBasicMaterial({color: 0xff0000});
			var box=new THREE.Mesh(geo,mat);
			//scene.add(box);


			//key controls
			var xSpeed = 0.1;
			var ySpeed = 0.1;
			document.addEventListener("keydown", onDocumentKeyDown, false);
			function onDocumentKeyDown(event) {
			    var keyCode = event.which;
			    if (keyCode == 87) {
			        camera.position.z -= ySpeed;
					characterfirst.position.z-= ySpeed;
							console.log("up key");
							//console.log(5);
							console.log(characterfirst.position.z);
							console.log(trigger.position.z);
			    } else if (keyCode == 83) {
			        camera.position.z += ySpeed;
					characterfirst.position.z+= ySpeed;
			    } else if (keyCode == 65) {
			        camera.position.x -= xSpeed;
					characterfirst.position.x-= xSpeed;
			    } else if (keyCode == 68) {
			        camera.position.x += xSpeed;
					characterfirst.position.x+= xSpeed;
			    } else if (keyCode == 32) {
			        camera.position.set(0, 0, 0);
			    }	else if (keyCode == 37) {
							characterfirst.position.x-=0.05;
					}	else if (keyCode == 39) {
							characterfirst.position.x+=0.05;
					}
			};



			var t=0;
			var x=0;
			const animate = function () {
				t += 0.01;
				x +=0.2;
				requestAnimationFrame( animate );

				cube.rotation.x += 0.01;
				cube.rotation.y += 0.01;

				//sphere.rotation.x += 0.01;
				//sphere.rotation.y += 0.01;

				characterfirst.position.y+=(Math.sin(x)/100);

				box.scale.y= Math.abs(Math.sin(t));
				box.scale.x= Math.abs(Math.sin(t));

				if (Math.abs(characterfirst.position.z-trigger.position.z)<0.5){
					//triggmat.color=0xff00ff;
					if(gate.position.y<1.2){
						gate.position.y+=0.01;
					}
					else{
						gate.position.x+=0.02;	
					}
				}

				renderer.render( scene, camera );
			};

			animate();
		</script>
	</body>
</html>
